<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ HaxBall DreamTeam - Admin Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            text-align: center;
        }

        .login-container h2 {
            margin-bottom: 30px;
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.3s;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .admin-panel {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid #eee;
            flex-wrap: wrap;
            gap: 10px;
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
            border-radius: 10px 10px 0 0;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .stat-card p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .form-inline {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: end;
        }

        .form-inline .form-group {
            margin-bottom: 0;
            flex: 1;
            min-width: 200px;
        }

        .table-container {
            overflow-x: auto;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .btn-small {
            padding: 8px 15px;
            font-size: 14px;
            margin: 2px;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-success {
            background: #28a745;
        }

        .alert {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .purple-coins-section {
            background: linear-gradient(135deg, #6f42c1 0%, #563d7c 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .simulation-card {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .simulation-card h3 {
            color: #856404;
            margin-bottom: 15px;
        }

        .price-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .price-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #667eea;
            text-align: center;
        }

        .loading {
            text-align: center;
            padding: 20px;
            font-size: 18px;
            color: #666;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .form-inline {
                flex-direction: column;
            }
            
            .form-inline .form-group {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ HaxBall DreamTeam</h1>
            <p>Painel Administrativo</p>
        </div>

        <div id="loginContainer" class="login-container">
            <h2>üîê Login de Administrador</h2>
            <div class="form-group">
                <label for="password">Senha:</label>
                <input type="password" id="password" placeholder="Digite a senha de admin">
            </div>
            <button class="btn" onclick="login()">Entrar</button>
            <div id="loginMessage"></div>
        </div>

        <div id="adminPanel" class="admin-panel">
            <div class="tabs">
                <button class="tab active" onclick="showTab('dashboard')">üìä Dashboard</button>
                <button class="tab" onclick="showTab('teams')">üë• Times</button>
                <button class="tab" onclick="showTab('players')">üé¥ Jogadores</button>
                <button class="tab" onclick="showTab('templates')">‚öôÔ∏è Templates</button>
                <button class="tab" onclick="showTab('tournaments')">üèÜ Torneios</button>
                <button class="tab" onclick="showTab('purplecoins')">üí∞ Purple Coins</button>
                <button class="tab" onclick="showTab('codes')">üéüÔ∏è C√≥digos</button>
                <button class="tab" onclick="showTab('simulation')">üíé Simula√ß√£o Econ√¥mica</button>
            </div>

            <div id="dashboard" class="tab-content active">
                <h2>üìä Dashboard</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3 id="totalPlayers">-</h3>
                        <p>üë• Total de Jogadores</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalTeams">-</h3>
                        <p>üèÜ Total de Times</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalCards">-</h3>
                        <p>üé¥ Total de Cartas</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalTemplates">-</h3>
                        <p>‚öôÔ∏è Templates</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalTournaments">-</h3>
                        <p>üèÜ Torneios</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalPurpleCoins">-</h3>
                        <p>üí∞ Purple Coins em Circula√ß√£o</p>
                    </div>
                </div>
            </div>

            <div id="teams" class="tab-content">
                <h2>üë• Gerenciar Times</h2>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>Dono</th>
                                <th>Vit√≥rias</th>
                                <th>Derrotas</th>
                                <th>Gols Pr√≥</th>
                                <th>Gols Contra</th>
                                <th>Criado em</th>
                            </tr>
                        </thead>
                        <tbody id="teamsTable">
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="players" class="tab-content">
                <h2>üé¥ Gerenciar Jogadores</h2>
                <div class="form-inline">
                    <div class="form-group">
                        <label for="playerSearch">Buscar Jogador:</label>
                        <input type="text" id="playerSearch" placeholder="Discord ID ou nome">
                    </div>
                    <button class="btn" onclick="searchPlayers()">üîç Buscar</button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Discord ID</th>
                                <th>Nome</th>
                                <th>Purple Coins</th>
                                <th>Cartas</th>
                                <th>Vit√≥rias</th>
                                <th>Derrotas</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="playersTable">
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="templates" class="tab-content">
                <h2>‚öôÔ∏è Gerenciar Templates</h2>
                <div class="form-inline">
                    <div class="form-group">
                        <label for="templateName">Nome:</label>
                        <input type="text" id="templateName" placeholder="Nome do jogador">
                    </div>
                    <div class="form-group">
                        <label for="templatePosition">Posi√ß√£o:</label>
                        <select id="templatePosition">
                            <option value="GK">ü•Ö Goleiro</option>
                            <option value="VL">‚öΩ Volante</option>
                            <option value="PV">üéØ Piv√¥</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="templateAvatar">Avatar:</label>
                        <input type="text" id="templateAvatar" placeholder="C√≥digo do emoji (opcional)">
                    </div>
                    <button class="btn btn-success" onclick="createTemplate()">‚ûï Criar Template</button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>Posi√ß√£o</th>
                                <th>Avatar</th>
                                <th>Criado em</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="templatesTable">
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="tournaments" class="tab-content">
                <h2>üèÜ Gerenciar Torneios</h2>
                <div class="form-inline">
                    <div class="form-group">
                        <label for="tournamentName">Nome do Torneio:</label>
                        <input type="text" id="tournamentName" placeholder="Ex: Copa HaxBall 2025">
                    </div>
                    <div class="form-group">
                        <label for="tournamentMaxTeams">M√°ximo de Times:</label>
                        <input type="number" id="tournamentMaxTeams" placeholder="8" min="2" max="32">
                    </div>
                    <div class="form-group">
                        <label for="tournamentPrize">Pr√™mio (Purple Coins):</label>
                        <input type="number" id="tournamentPrize" placeholder="1000" min="0">
                    </div>
                    <div class="form-group">
                        <label for="tournamentDescription">Descri√ß√£o:</label>
                        <input type="text" id="tournamentDescription" placeholder="Descri√ß√£o do torneio">
                    </div>
                    <button class="btn btn-success" onclick="createTournament()">üèÜ Criar Torneio</button>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>Status</th>
                                <th>Times</th>
                                <th>M√°x. Times</th>
                                <th>Pr√™mio</th>
                                <th>Criado em</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tournamentsTable">
                        </tbody>
                    </table>
                </div>
                
                <div class="tournament-details" id="tournamentDetails" style="display: none;">
                    <h3>üìã Detalhes do Torneio</h3>
                    <div id="tournamentInfo"></div>
                    <div class="form-inline">
                        <button class="btn btn-primary" onclick="startTournament()">‚ñ∂Ô∏è Iniciar Torneio</button>
                        <button class="btn btn-warning" onclick="pauseTournament()">‚è∏Ô∏è Pausar</button>
                        <button class="btn btn-success" onclick="finishTournament()">üèÅ Finalizar</button>
                        <button class="btn btn-danger" onclick="cancelTournament()">‚ùå Cancelar</button>
                    </div>
                    <div class="table-container">
                        <h4>üë• Times Inscritos</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>L√≠der</th>
                                    <th>Jogadores</th>
                                    <th>Data Inscri√ß√£o</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="tournamentTeamsTable">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="purplecoins" class="tab-content">
                <div class="purple-coins-section">
                    <h2>üí∞ Gerenciar Purple Coins</h2>
                    <div class="form-inline">
                        <div class="form-group">
                            <label for="coinDiscordId">Discord ID:</label>
                            <input type="text" id="coinDiscordId" placeholder="ID do Discord do jogador">
                        </div>
                        <div class="form-group">
                            <label for="coinAmount">Quantidade:</label>
                            <input type="number" id="coinAmount" placeholder="Quantidade de moedas">
                        </div>
                        <button class="btn btn-success" onclick="addPurpleCoins()">‚ûï Adicionar Moedas</button>
                    </div>
                </div>
            </div>

            <div id="codes" class="tab-content">
                <h2>üéüÔ∏è Sistema de C√≥digos Purple Coins</h2>
                <div class="form-inline">
                    <div class="form-group">
                        <label for="codeValue">Valor em Purple Coins:</label>
                        <input type="number" id="codeValue" placeholder="100" value="100">
                    </div>
                    <div class="form-group">
                        <label for="customCode">C√≥digo Personalizado (opcional):</label>
                        <input type="text" id="customCode" placeholder="PC12345 (deixe vazio para gerar automaticamente)">
                    </div>
                    <button class="btn btn-success" onclick="createPurpleCoinCode()">üé´ Gerar C√≥digo</button>
                </div>
                
                <div id="codesTable">
                    <h3>üìä C√≥digos Criados</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>C√≥digo</th>
                                    <th>Valor</th>
                                    <th>Usado por</th>
                                    <th>Usado em</th>
                                    <th>Criado em</th>
                                    <th>Status</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="codesTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="simulation" class="tab-content">
                <h2>üíé Simula√ß√£o Econ√¥mica Purple Coins</h2>
                
                <div class="simulation-card">
                    <h3>üìà An√°lise de Valor das Purple Coins</h3>
                    <p><strong>Baseado na economia atual do jogo:</strong></p>
                    
                    <div class="price-grid">
                        <div class="price-card">
                            <h4>üí∞ Valor Sugerido</h4>
                            <h3>R$ 0,05</h3>
                            <p>por Purple Coin</p>
                            <small>Valor acess√≠vel para microtransa√ß√µes</small>
                        </div>
                        
                        <div class="price-card">
                            <h4>üìä Ganho Di√°rio M√©dio</h4>
                            <h3>50-150</h3>
                            <p>Purple Coins/dia</p>
                            <small>Jogador ativo (partidas + comandos)</small>
                        </div>
                        
                        <div class="price-card">
                            <h4>üíµ Potencial de Renda</h4>
                            <h3>R$ 2,50 - R$ 7,50</h3>
                            <p>por dia por jogador</p>
                            <small>Estimativa baseada na atividade</small>
                        </div>
                        
                        <div class="price-card">
                            <h4>üì¶ Pacotes Sugeridos</h4>
                            <h3>100 = R$ 5,00</h3>
                            <h3>500 = R$ 20,00</h3>
                            <h3>1000 = R$ 35,00</h3>
                            <small>Descontos progressivos</small>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background: #fff; border-radius: 10px;">
                        <h4>üéØ Como funcionar√°:</h4>
                        <ul style="margin-left: 20px;">
                            <li>Jogadores compram c√≥digos atrav√©s de site externo</li>
                            <li>Recebem c√≥digo √∫nico para resgatar no Discord</li>
                            <li>Usam comando <code>/codigo PCXXXXXX</code> para resgatar</li>
                            <li>Purple Coins s√£o automaticamente adicionadas √† conta</li>
                            <li>Admin pode acompanhar todos os c√≥digos usados aqui</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div id="message"></div>
    </div>

    <script>
        let isLoggedIn = false;

        async function login() {
            const password = document.getElementById('password').value;
            const messageDiv = document.getElementById('loginMessage');
            
            if (!password) {
                showMessage('Digite a senha!', 'danger');
                return;
            }

            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ password })
                });

                const data = await response.json();

                if (data.success) {
                    isLoggedIn = true;
                    document.getElementById('loginContainer').style.display = 'none';
                    document.getElementById('adminPanel').style.display = 'block';
                    loadStats();
                    loadTeams();
                    loadPlayers();
                    loadTemplates();
                    loadPurpleCoinCodes();
                } else {
                    showMessage('Senha incorreta!', 'danger');
                }
            } catch (error) {
                showMessage('Erro ao fazer login: ' + error.message, 'danger');
            }
        }

        function showTab(tabName) {
            // Esconder todas as abas
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Mostrar aba selecionada
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // Carregar dados espec√≠ficos da aba
            if (tabName === 'teams') loadTeams();
            if (tabName === 'players') loadPlayers();
            if (tabName === 'templates') loadTemplates();
            if (tabName === 'tournaments') loadTournaments();
            if (tabName === 'codes') loadPurpleCoinCodes();
        }

        async function loadStats() {
            try {
                const response = await fetch('/api/stats');
                const data = await response.json();

                if (data.success) {
                    document.getElementById('totalPlayers').textContent = data.data.totalPlayers;
                    document.getElementById('totalTeams').textContent = data.data.totalTeams;
                    document.getElementById('totalCards').textContent = data.data.totalCards;
                    document.getElementById('totalTemplates').textContent = data.data.totalTemplates;
                    document.getElementById('totalTournaments').textContent = data.data.totalTournaments || 0;
                    document.getElementById('totalPurpleCoins').textContent = data.data.totalPurpleCoins;
                }
            } catch (error) {
                console.error('Erro ao carregar stats:', error);
            }
        }

        async function loadTeams() {
            try {
                const response = await fetch('/api/teams');
                const teams = await response.json();
                const tbody = document.getElementById('teamsTable');
                
                tbody.innerHTML = teams.map(team => `
                    <tr>
                        <td>${team.id}</td>
                        <td>${team.name}</td>
                        <td>${team.owner_discord_id}</td>
                        <td>${team.wins}</td>
                        <td>${team.losses}</td>
                        <td>${team.goals_for}</td>
                        <td>${team.goals_against}</td>
                        <td>${new Date(team.created_at).toLocaleDateString()}</td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Erro ao carregar times:', error);
            }
        }

        async function loadPlayers(search = '') {
            try {
                const url = search ? `/api/players?search=${encodeURIComponent(search)}` : '/api/players';
                const response = await fetch(url);
                const players = await response.json();
                const tbody = document.getElementById('playersTable');
                
                tbody.innerHTML = players.map(player => `
                    <tr>
                        <td>${player.discord_id}</td>
                        <td>${player.username || 'N/A'}</td>
                        <td>${player.purple_coins}</td>
                        <td>${player.total_cards}</td>
                        <td>${player.wins}</td>
                        <td>${player.losses}</td>
                        <td>
                            <button class="btn btn-small btn-success" onclick="promptAddCoins('${player.discord_id}')">
                                üí∞ Adicionar Moedas
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Erro ao carregar jogadores:', error);
            }
        }

        async function loadTemplates() {
            try {
                const response = await fetch('/api/templates');
                const templates = await response.json();
                const tbody = document.getElementById('templatesTable');
                
                tbody.innerHTML = templates.map(template => `
                    <tr>
                        <td>${template.id}</td>
                        <td>${template.name}</td>
                        <td>${template.position}</td>
                        <td>${template.avatar ? String.fromCodePoint(parseInt(template.avatar, 16)) : 'N/A'}</td>
                        <td>${new Date(template.created_at).toLocaleDateString()}</td>
                        <td>
                            <button class="btn btn-small btn-danger" onclick="deleteTemplate(${template.id})">
                                üóëÔ∏è Excluir
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Erro ao carregar templates:', error);
            }
        }

        async function loadPurpleCoinCodes() {
            try {
                const response = await fetch('/api/purple-coins');
                const codes = await response.json();
                const tbody = document.getElementById('codesTableBody');
                
                tbody.innerHTML = codes.map(code => `
                    <tr>
                        <td><strong>${code.code}</strong></td>
                        <td>${code.purple_coins_value}</td>
                        <td>${code.used_by_discord_id || 'N√£o usado'}</td>
                        <td>${code.used_at ? new Date(code.used_at).toLocaleDateString() : 'N/A'}</td>
                        <td>${new Date(code.created_at).toLocaleDateString()}</td>
                        <td>
                            <span style="color: ${code.used_by_discord_id ? 'red' : 'green'};">
                                ${code.used_by_discord_id ? '‚ùå Usado' : '‚úÖ Dispon√≠vel'}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-small btn-danger" onclick="deletePurpleCoinCode(${code.id})">
                                üóëÔ∏è Excluir
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Erro ao carregar c√≥digos:', error);
            }
        }

        function searchPlayers() {
            const search = document.getElementById('playerSearch').value;
            loadPlayers(search);
        }

        function promptAddCoins(discordId) {
            const amount = prompt('Quantas Purple Coins adicionar?');
            if (amount && !isNaN(amount)) {
                addPurpleCoinsToPlayer(discordId, parseInt(amount));
            }
        }

        async function addPurpleCoins() {
            const discordId = document.getElementById('coinDiscordId').value;
            const amount = document.getElementById('coinAmount').value;

            if (!discordId || !amount) {
                showMessage('Preencha Discord ID e quantidade!', 'danger');
                return;
            }

            await addPurpleCoinsToPlayer(discordId, parseInt(amount));
        }

        async function addPurpleCoinsToPlayer(discordId, amount) {
            try {
                const response = await fetch('/api/players', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        discord_id: discordId,
                        purple_coins: amount
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showMessage(data.message, 'success');
                    loadPlayers();
                    loadStats();
                    // Limpar campos
                    document.getElementById('coinDiscordId').value = '';
                    document.getElementById('coinAmount').value = '';
                } else {
                    showMessage(data.message, 'danger');
                }
            } catch (error) {
                showMessage('Erro ao adicionar moedas: ' + error.message, 'danger');
            }
        }

        async function createTemplate() {
            const name = document.getElementById('templateName').value;
            const position = document.getElementById('templatePosition').value;
            const avatar = document.getElementById('templateAvatar').value;

            if (!name || !position) {
                showMessage('Nome e posi√ß√£o s√£o obrigat√≥rios!', 'danger');
                return;
            }

            try {
                const response = await fetch('/api/templates', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ name, position, avatar })
                });

                const data = await response.json();

                if (data.success) {
                    showMessage(data.message, 'success');
                    loadTemplates();
                    loadStats();
                    // Limpar campos
                    document.getElementById('templateName').value = '';
                    document.getElementById('templateAvatar').value = '';
                } else {
                    showMessage(data.message, 'danger');
                }
            } catch (error) {
                showMessage('Erro ao criar template: ' + error.message, 'danger');
            }
        }

        async function deleteTemplate(id) {
            if (!confirm('Tem certeza que deseja excluir este template?')) {
                return;
            }

            try {
                const response = await fetch(`/api/templates?id=${id}`, {
                    method: 'DELETE'
                });

                const data = await response.json();

                if (data.success) {
                    showMessage(data.message, 'success');
                    loadTemplates();
                    loadStats();
                } else {
                    showMessage(data.message, 'danger');
                }
            } catch (error) {
                showMessage('Erro ao excluir template: ' + error.message, 'danger');
            }
        }

        // ===== FUN√á√ïES DE TORNEIOS =====
        async function createTournament() {
            const name = document.getElementById('tournamentName').value;
            const maxTeams = parseInt(document.getElementById('tournamentMaxTeams').value);
            const prize = parseInt(document.getElementById('tournamentPrize').value);
            const description = document.getElementById('tournamentDescription').value;

            if (!name || !maxTeams || maxTeams < 2) {
                showMessage('Nome e n√∫mero v√°lido de times s√£o obrigat√≥rios!', 'danger');
                return;
            }

            try {
                const response = await fetch('/api/tournaments', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        name, 
                        max_teams: maxTeams, 
                        prize_purple_coins: prize || 0,
                        description: description || ''
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showMessage('Torneio criado com sucesso!', 'success');
                    document.getElementById('tournamentName').value = '';
                    document.getElementById('tournamentMaxTeams').value = '';
                    document.getElementById('tournamentPrize').value = '';
                    document.getElementById('tournamentDescription').value = '';
                    loadTournaments();
                    loadStats();
                } else {
                    showMessage(data.message, 'danger');
                }
            } catch (error) {
                showMessage('Erro ao criar torneio: ' + error.message, 'danger');
            }
        }

        async function loadTournaments() {
            try {
                const response = await fetch('/api/tournaments');
                const data = await response.json();

                if (data.success) {
                    const tableBody = document.getElementById('tournamentsTable');
                    tableBody.innerHTML = '';

                    data.tournaments.forEach(tournament => {
                        const row = document.createElement('tr');
                        const statusText = {
                            'ATIVO': 'üü¢ Ativo',
                            'EM_ANDAMENTO': '‚ö° Em Andamento',
                            'FINALIZADO': 'üèÅ Finalizado',
                            'CANCELADO': '‚ùå Cancelado'
                        };

                        row.innerHTML = `
                            <td>${tournament.id}</td>
                            <td>${tournament.name}</td>
                            <td>${statusText[tournament.status] || tournament.status}</td>
                            <td>${tournament.registered_teams || 0}</td>
                            <td>${tournament.max_teams}</td>
                            <td>${tournament.prize_purple_coins || 0} PC</td>
                            <td>${new Date(tournament.created_at).toLocaleDateString()}</td>
                            <td>
                                <button class="btn btn-sm btn-info" onclick="viewTournament(${tournament.id})">üëÅÔ∏è Ver</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteTournament(${tournament.id})">üóëÔ∏è Excluir</button>
                            </td>
                        `;
                        tableBody.appendChild(row);
                    });
                }
            } catch (error) {
                console.error('Erro ao carregar torneios:', error);
            }
        }

        async function deleteTournament(id) {
            if (!confirm('Tem certeza que deseja excluir este torneio? Esta a√ß√£o n√£o pode ser desfeita.')) {
                return;
            }

            try {
                const response = await fetch(`/api/tournaments?id=${id}`, {
                    method: 'DELETE'
                });

                const data = await response.json();

                if (data.success) {
                    showMessage('Torneio exclu√≠do com sucesso!', 'success');
                    loadTournaments();
                    loadStats();
                } else {
                    showMessage(data.message, 'danger');
                }
            } catch (error) {
                showMessage('Erro ao excluir torneio: ' + error.message, 'danger');
            }
        }

        async function viewTournament(id) {
            try {
                const response = await fetch(`/api/tournaments?id=${id}`);
                const data = await response.json();

                if (data.success) {
                    const tournament = data.tournament;
                    const detailsDiv = document.getElementById('tournamentDetails');
                    const infoDiv = document.getElementById('tournamentInfo');
                    
                    infoDiv.innerHTML = `
                        <div class="tournament-info-grid">
                            <div><strong>Nome:</strong> ${tournament.name}</div>
                            <div><strong>Status:</strong> ${tournament.status}</div>
                            <div><strong>Times:</strong> ${tournament.registered_teams || 0}/${tournament.max_teams}</div>
                            <div><strong>Pr√™mio:</strong> ${tournament.prize_purple_coins || 0} Purple Coins</div>
                            <div><strong>Descri√ß√£o:</strong> ${tournament.description || 'Nenhuma'}</div>
                            <div><strong>Criado em:</strong> ${new Date(tournament.created_at).toLocaleString()}</div>
                        </div>
                    `;
                    
                    detailsDiv.style.display = 'block';
                    window.currentTournamentId = id;
                    loadTournamentTeams(id);
                }
            } catch (error) {
                showMessage('Erro ao carregar detalhes do torneio: ' + error.message, 'danger');
            }
        }

        async function loadTournamentTeams(tournamentId) {
            try {
                const response = await fetch(`/api/tournaments/teams?tournament_id=${tournamentId}`);
                const data = await response.json();

                if (data.success) {
                    const tableBody = document.getElementById('tournamentTeamsTable');
                    tableBody.innerHTML = '';

                    data.teams.forEach(team => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${team.team_name}</td>
                            <td>${team.leader_name}</td>
                            <td>${team.player_count || 0}</td>
                            <td>${new Date(team.registered_at).toLocaleDateString()}</td>
                            <td>
                                <button class="btn btn-sm btn-danger" onclick="removeTournamentTeam('${team.team_id}')">‚ùå Remover</button>
                            </td>
                        `;
                        tableBody.appendChild(row);
                    });
                }
            } catch (error) {
                console.error('Erro ao carregar times do torneio:', error);
            }
        }

        async function startTournament() {
            if (!window.currentTournamentId) return;
            
            try {
                const response = await fetch('/api/tournaments/status', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        id: window.currentTournamentId,
                        status: 'EM_ANDAMENTO'
                    })
                });

                const data = await response.json();
                if (data.success) {
                    showMessage('Torneio iniciado!', 'success');
                    loadTournaments();
                    viewTournament(window.currentTournamentId);
                } else {
                    showMessage(data.message, 'danger');
                }
            } catch (error) {
                showMessage('Erro ao iniciar torneio: ' + error.message, 'danger');
            }
        }

        async function finishTournament() {
            if (!window.currentTournamentId) return;
            
            try {
                const response = await fetch('/api/tournaments/status', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        id: window.currentTournamentId,
                        status: 'FINALIZADO'
                    })
                });

                const data = await response.json();
                if (data.success) {
                    showMessage('Torneio finalizado!', 'success');
                    loadTournaments();
                    viewTournament(window.currentTournamentId);
                } else {
                    showMessage(data.message, 'danger');
                }
            } catch (error) {
                showMessage('Erro ao finalizar torneio: ' + error.message, 'danger');
            }
        }

        async function createPurpleCoinCode() {
            const value = document.getElementById('codeValue').value;
            const customCode = document.getElementById('customCode').value;

            if (!value || value <= 0) {
                showMessage('Digite um valor v√°lido para Purple Coins!', 'danger');
                return;
            }

            try {
                const response = await fetch('/api/purple-coins', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'create',
                        purple_coins_value: parseInt(value),
                        code: customCode || undefined
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showMessage(`${data.message} - C√≥digo: ${data.code}`, 'success');
                    loadPurpleCoinCodes();
                    // Limpar campos
                    document.getElementById('customCode').value = '';
                } else {
                    showMessage(data.message, 'danger');
                }
            } catch (error) {
                showMessage('Erro ao criar c√≥digo: ' + error.message, 'danger');
            }
        }

        async function deletePurpleCoinCode(id) {
            if (!confirm('Tem certeza que deseja excluir este c√≥digo?')) {
                return;
            }

            try {
                const response = await fetch(`/api/purple-coins?id=${id}`, {
                    method: 'DELETE'
                });

                const data = await response.json();

                if (data.success) {
                    showMessage(data.message, 'success');
                    loadPurpleCoinCodes();
                } else {
                    showMessage(data.message, 'danger');
                }
            } catch (error) {
                showMessage('Erro ao excluir c√≥digo: ' + error.message, 'danger');
            }
        }

        function showMessage(message, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => {
                messageDiv.innerHTML = '';
            }, 5000);
        }

        // Auto-login se pressionar Enter
        document.getElementById('password').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                login();
            }
        });
    </script>
</body>
</html>
